;(function(window,undefined,define){var campaignTools={};campaignTools.UA=(function(){var ua=navigator.userAgent.toLowerCase();var uaObj={};uaObj.inWdj=typeof window.campaignPlugin!=='undefined'&&window.campaignPlugin;uaObj.inWechat=!!ua.match(/micromessenger/);uaObj.inIos=!!ua.match(/(iphone|ipod|ipad)/);uaObj.inAndroid=!!ua.match(/(android)/);uaObj.inWp=!!ua.match(/(windows phone)/);uaObj.inSymbian=!!ua.match(/(symbianos)/);uaObj.inMac=navigator.platform.indexOf('Mac')===0;uaObj.inWindows=navigator.platform.indexOf('Win')===0;uaObj.inIphone=!!ua.match(/(iphone)/);uaObj.inIpad=!!ua.match(/(ipad)/);uaObj.inMobile=(uaObj.inIos||uaObj.inAndroid||uaObj.inWp||uaObj.inSymbian);uaObj.inPC=!(uaObj.inIos||uaObj.inAndroid||uaObj.inWp||uaObj.inSymbian);uaObj.isRetina=typeof window.campaignPlugin!=='undefined'&&window.devicePixelRatio>1;uaObj.inWindow=uaObj.inWindows;return uaObj;})();campaignTools.inPC=campaignTools.UA.inPC;if(campaignTools.UA.inWdj){var campaignPlugin=window.campaignPlugin;campaignTools.runSystemShare=function(title,content){title=title||'豌豆荚';content=content||'你的手机娱乐中心';campaignPlugin.share(title,content);};campaignTools.runAppShare=function(title,content,imgUrl,shareUrl,appType){title=title||'豌豆荚';content=content||'你的手机娱乐中心';imgUrl=imgUrl||'http://static.wdjimg.com/www/images/www/p4.png';shareUrl=shareUrl||'http://www.wandoujia.com/';appType=appType||'SINA_WEIBO';campaignPlugin.shareTo(title,content,imgUrl,shareUrl,appType);};campaignTools.openInBrowser=function(url){campaignPlugin.openInBrowser(url);};campaignTools.getUDID=function(){return campaignPlugin.getUDID();};campaignTools.getUID=function(){return campaignPlugin.getUID();};campaignTools.getAvatar=function(){return campaignPlugin.getAvatar();};campaignTools.getUserEmail=function(){return campaignPlugin.getUserEmail();};campaignTools.getNickName=function(){return campaignPlugin.getNickName();};campaignTools.getUserAuth=function(){return campaignPlugin.getUserAuth();};campaignTools.isLogin=function(){return campaignPlugin.isLogin();};campaignTools.getPhoneNumber=function(){return campaignPlugin.getPhoneNumber();};campaignTools.openUserDetail=function(uid){campaignPlugin.openUserDetail(uid);};campaignTools.isInstalled=function(packageName){return campaignPlugin.isInstalled(packageName);};campaignTools.isUpgradable=function(packageName){return campaignPlugin.isUpgradable(packageName);};campaignTools.getAppState=function(packageName){return campaignPlugin.getAppState(packageName);};campaignTools.getAppVersionCode=function(packageName){return campaignPlugin.getAppVersionCode(packageName);};campaignTools.getAppVersionName=function(packageName){return campaignPlugin.getAppVersionName(packageName);};campaignTools.openApp=function(packageName){campaignPlugin.openApp(packageName);};campaignTools.openAppDetail=function(packageName){campaignPlugin.openAppDetail(packageName);};campaignTools.openAppDetailWithoutAward=function(packageName){campaignPlugin.openAppDetailWithoutAward(packageName);};campaignTools.sendIntent=function(serializedIntent){campaignPlugin.startActivity(serializedIntent);};campaignTools.openVideoDetail=function(id){campaignPlugin.startActivity('wdj://detail/video/'+id+'?video_type=');};campaignTools.openEbookDetail=function(id){campaignPlugin.startActivity('wdj://detail/ebbok/'+id);};campaignTools.searchWords=function(str){campaignPlugin.startActivity('wdj://search?q='+str);};campaignTools.openSubscribeDetail=function(id,type){campaignPlugin.startActivity('wdj://detail/subscribe/publisher/'+type+'/'+id);};campaignTools.openSubscribePublisher=function(uid){if(typeof campaignPlugin.openSubscribePublisher!=='undefined'){campaignPlugin.openSubscribePublisher(uid);}else{var url='intent://subscribe.wandoujia.com/publisher/ACCOUNT/'+uid+'#Intent;scheme=http;action=android.intent.action.MAIN;end';campaignPlugin.startActivity(url);}};campaignTools.openSubscribeSubset=function(id){if(typeof campaignPlugin.openSubscribeSubset!=='undefined'){campaignPlugin.openSubscribeSubset(id);}else{var url='intent://subscribe.wandoujia.com/list/'+id+'#Intent;scheme=http;action=android.intent.action.MAIN;end';campaignPlugin.startActivity(url);}};campaignTools.loginAccount=function(){if(typeof campaignTools.loginAccount!=='undefined'){campaignPlugin.loginAccount();}else{campaignPlugin.startActivity('intent:#Intent;component=com.wandoujia.phoenix2/com.wandoujia.p4.account.activity.PhoenixAccountActivity;end');}};campaignTools.choseLoginAccount=function(){campaignPlugin.startActivity('intent://account.wandoujia.com/android/login#Intent;scheme=https;action=android.intent.action.MAIN;end');};campaignTools.installApp=function(app,callback){var installed=false;if(typeof campaignPlugin.installByPackage!==undefined){campaignPlugin.installByPackage(app.packageName);responseCallback({'error':0,'message':'安装成功'});}else{if(!app.packageName||!app.downloadUrl||!app.appName||!app.iconUrl){if(callback&&typeof callback==='function'){callback({'error':1,'message':'缺少必要参数'});}}else{campaignPlugin.install(app.packageName,app.downloadUrl,app.appName,app.iconUrl,app.size);responseCallback({'error':0,'message':'安装成功'});}}
function responseCallback(object){if(callback&&typeof callback==='function'){var checkInstalled=setInterval(function(){installed=campaignPlugin.isInstalled(app.packageName);if(installed){clearInterval(checkInstalled);checkInstalled=0;callback(object);}},1500);}}};campaignTools.reload=function(){campaignPlugin.reload();};campaignTools.setOrientation=function(isVertical){campaignPlugin.setOrientation(isVertical);};campaignTools.download=function(url,title,type){campaignPlugin.download(url,title,type);};campaignTools.closeWebView=function(){campaignPlugin.closeWebView();};campaignTools.openNewWebView=function(url,title,showActionBar,isPortrait,isFullScreen){url=url||'http://www.wandoujia.com';title=title||'豌豆荚';showActionBar=showActionBar||true;isPortrait=isPortrait||true;isFullScreen=isFullScreen||false;campaignPlugin.openNewWebView(url,title,showActionBar,isPortrait,isFullScreen);};campaignTools.getVersionCode=function(){return campaignPlugin.getVersionCode();};campaignTools.getVersionName=function(){return campaignPlugin.getVersionName();};campaignTools.getFullVersionName=function(){return campaignPlugin.getFullVersionName();};campaignTools.getIMEI=function(){return campaignPlugin.getIMEI();};campaignTools.getBrand=function(){return campaignPlugin.getBrand();};campaignTools.getNetworkType=function(){return campaignPlugin.getNetworkType();};campaignTools.getLocaleLanguage=function(){return campaignPlugin.getLocaleLanguage();};campaignTools.getLocaleCountry=function(){return campaignPlugin.getLocaleCountry();};campaignTools.getSDKVersion=function(){return campaignPlugin.getSDKVersionInt();};campaignTools.setClipboardText=function(string){return campaignPlugin.setClipboardText(string);};campaignTools.toast=function(string){campaignPlugin.toast(string);};}
campaignTools.constant={telReg:/^0?(13[0-9]|15[0-9]|18[0-9]|14[57]|17[0])[0-9]{8}$/};campaignTools.api={needle:'http://www.wandoujia.com/needle/source/',apps:'http://www.wandoujia.com/api/apps/apps',appsOptFields:'?opt_fields=title,icons.*,apks.*.size,apks.*.bytes,apks.*.downloadUrl.*.url,apks.*.creation,installedCountStr,apks.*.versionName,apks.*.versionCode',itemlist:'http://www.wandoujia.com/api/subscribe/itemlist/',subscribe:'http://www.wandoujia.com/api/subscribe/subscriber/subscribe',unsubscribe:'http://www.wandoujia.com/api/subscribe/subscriber/unsubscribe',subscribeStatus:'http://www.wandoujia.com/api/subscribe/publisher/ACCOUNT/'};campaignTools.getFeedListData=function(id,callback){$.ajax({url:campaignTools.api.itemlist+id+'/summary',dataType:'json',success:function(resp){if(callback&&typeof callback==='function'){callback(resp);}}});};campaignTools.getFeedItemsData=function(id,callback){$.ajax({url:campaignTools.api.itemlist+id+'/item',dataType:'json',success:function(resp){if(callback&&typeof callback==='function'){callback(resp);}}});};campaignTools.getSubscribeStatus=function(uid,callback){$.ajax({url:campaignTools.api.subscribeStatus+uid,dataType:'json',success:function(resp){if(callback&&typeof callback==='function'){callback(resp);}}});};campaignTools.subscribe=function(uid,callback){$.ajax({url:campaignTools.api.subscribe,dataType:'json',contentType:'application/json; charset=UTF-8',type:'POST',data:JSON.stringify([{'type':'ACCOUNT','id':uid}]),success:function(resp){if(callback&&typeof callback==='function'){callback(resp);}}});};campaignTools.unsubscribe=function(uid,callback){var req=new XMLHttpRequest();req.open('POST',campaignTools.api.unsubscribe,false);req.send(JSON.stringify([{'type':'ACCOUNT','id':uid,'wdj_auth':$.cookie('wdj_auth')}]));var headers=req.getAllResponseHeaders().toLowerCase();if(req.status===200){if(callback&&typeof callback==='function'){callback();}}};campaignTools.pushGaEvent=function(category,action,label,value){category=category||'';action=action||'';label=label||'';value=parseInt(value,10)||0;if(typeof ga!=='undefined'&&ga){ga('send','event',category,action,label,value);}else if(typeof _gaq!=='undefined'&&_gaq){_gaq.push(['_trackEvent',category,action,label,value]);}};campaignTools.setFullScreenHeight=function(minHeight){var height=window.innerHeight;minHeight=minHeight||480;if(height<minHeight){setTimeout(function(){height=window.innerHeight;if(height<minHeight){height=minHeight;}
document.body.style.height=height+'px';},1000);}else{document.body.style.height=height+'px';}};campaignTools.parseQueryString=function(){var str=window.location.search;var objURL={};str.replace(new RegExp('([^?=&]+)(=([^&]*))?','g'),function($0,$1,$2,$3){objURL[$1]=$3;});return objURL;};campaignTools.wechatWebviewShareSetup=function(shareTimelineObject,shareFriendObject){$.ajax({url:'http://who.wandoujia.com/wx-corp/js-sdk',type:'POST',data:{url:location.href.split('#')[0]}}).done(function(r){wx.config({debug:false,appId:r.appId,timestamp:r.timestamp,nonceStr:r.nonceStr,signature:r.signature,jsApiList:['checkJsApi','onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','hideMenuItems']});wx.ready(function(){wx.onMenuShareTimeline({title:shareTimelineObject.title,link:shareTimelineObject.link,imgUrl:shareTimelineObject.imgUrl,success:function(){if(shareTimelineObject.successCallback&&typeof shareTimelineObject.successCallback==='function'){shareTimelineObject.successCallback();}},cancel:function(){}});wx.onMenuShareAppMessage({title:shareFriendObject.title,desc:shareFriendObject.desc,link:shareFriendObject.link,imgUrl:shareFriendObject.imgUrl,type:'',dataUrl:'',success:function(){if(shareFriendObject.successCallback&&typeof shareFriendObject.successCallback==='function'){shareFriendObject.successCallback();}},cancel:function(){}});});});};campaignTools.shareButtonSetup=function(weibo,wechatFriend,wechatTimeline){var weiboURL='http://service.weibo.com/share/share.php?appkey=1483181040&relateUid=1727978503&url='+encodeURIComponent(weibo.shortLink||weibo.link)+'&title='+encodeURIComponent(weibo.desc)+'&pic='+weibo.imgUrl;if(campaignTools.UA.inWdj){$(weibo.element).click(function(){weibo.successCallback('P4-weibo-launch');campaignTools.toast('正在打开微博，请稍候...');campaignTools.runAppShare(null,weibo.desc,weibo.imgUrl,weibo.shortLink||weibo.link,'SINA_WEIBO');});$(wechatFriend.element).click(function(){wechatFriend.successCallback('P4-wechatFriend-launch');campaignTools.toast('正在打开微信，请稍候...');campaignTools.runAppShare(wechatFriend.title,wechatFriend.desc,wechatFriend.imgUrl,wechatFriend.link,'WECHAT');});$(wechatTimeline.element).click(function(){wechatTimeline.successCallback('P4-wechatTimeline-launch');campaignTools.toast('正在打开微信，请稍候...');campaignTools.runAppShare(wechatTimeline.title,wechatTimeline.title,wechatTimeline.imgUrl,wechatTimeline.link,'WECHAT_TIMELINE');});}else{$(weibo.element).click(function(){weibo.successCallback('weibo-redirect');location.href=weiboURL;});$(wechatFriend.element+', '+wechatTimeline.element).click(function(e){if(campaignTools.UA.inWechat){if($(this).is(wechatFriend.element)){wechatFriend.successCallback('wechat-wechatFriend-tips');wechatFriend.tips();}else{wechatTimeline.successCallback('wechat-wechatTimeline-tips');wechatTimeline.tips();}}else{if($(this).is(wechatFriend.element)){wechatFriend.successCallback('other-wechatFriend-tips');wechatFriend.qrcode();}else{wechatTimeline.successCallback('other-wechatTimeline-qrcode');wechatTimeline.qrcode();}}});}};var _campaignTools=window.campaignTools;window.campaignTools=campaignTools;campaignTools.noConflict=function(){window.campaignTools=_campaignTools;return campaignTools;};if(typeof define==='function'&&define.amd){define('campaignTools',[],function(){return campaignTools;});}})(this);